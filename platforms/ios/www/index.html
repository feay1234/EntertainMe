<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>EntertainMe</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="ratchet/css/ratchet.css">
    <link rel="stylesheet" href="css/index.css">   
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="cordova.js"></script>
    <script src="js/facebookConnectPlugin.js"></script>

    <script src="js/levenshtein.js"></script>
    <script src="js/mongolabConnection.js"></script>
    <script src="js/index.js"></script>

    <script src="ratchet/js/ratchet.min.js"></script>
    
    <script type="text/javascript">
        // app.initialize();

        var mode;
        // initial variables
        var _id; // mongolab id
        var id; // facebook id
        var username; // normal id
        var name; // real name
        var user_likes = "";
        var user_behaviour = "";
        var user_favorite = "";
        var user_type;
        var picture;
        var is_FB_User;
        var venues = [];
        document.addEventListener("deviceready", onDeviceReady, false);

        function onDeviceReady() {
            
            
            function getAuthentication(){
                // Get User Info From Facebok or Mongolabs
                facebookConnectPlugin.api( "me/likes?fields=category", ["user_likes"],
                    function (response) { 
                        user_likes = response;
                        // get user info
                        facebookConnectPlugin.api( "me", ["basic_info"],
                            function (response) { 
                                
                                id = response.id;
                                name = response.name;
                                
                                // MongoLabConnection.js
                                getID(id)
                                .done(function(result){
                                    _id = result._id.$oid;
                                    $("#login-content").hide();
                                    $("#home-content").show();
                                    app.initialize();
                                    
                                })
                                .fail(function(x){

                                })

                                // get user picture
                                facebookConnectPlugin.api( "me/picture?type=large&redirect=false", ["basic_info"],
                                    function (response) { 
                                        picture = response.data.url;
                                    },
                                    function (response) { 
                                        alert("Facebook Graph API fails") 
                                    }); 
                            },
                            function (response) { 

                                alert("Facebook Graph API fails") 
                            }); 

                    },
                    function (response) { 
                        // Not Facebook User
                        // TODO add normal ranking system here.
                        // User Info Initiation is done at CheckCookie.js.
                        alert("error")
                    }); 

                
            }
            // Check Authentication.

            $("#loginBtn").click(function(){
                mode = "normal"
                getAuthentication();
            })
            $("#loginFBBtn").click(function(){
                var fbLoginSuccess = function (userData) {
                    mode = "facebook";
                    getAuthentication();
                    // alert("UserInfo: " + JSON.stringify(userData));
                }

                facebookConnectPlugin.login(["basic_info"],
                    fbLoginSuccess,
                    function (error) { alert("" + error) }
                );

            })

            // Check Facebook Token
            facebookConnectPlugin.getLoginStatus( 
                    function (response) { 
                        // Got Facebook Access Token
                        mode = "facebook"
                        getAuthentication();
                        
                    },
                    function (response) { 
                        // No Facebook Access Token
                        // Do nothing
                    }
            );
        }
        
    </script>
  </head>
  <body>
    <header class="bar bar-nav">
      <button id="backBtn" class="btn btn-link btn-nav pull-left" style="display:none;">
          <span class="icon icon-left-nav"></span>
          Back
        </button>
      <h1 class="title">EntermainMe</h1>
    </header>

    <nav id="footer" class="bar bar-tab" style="display:none;">
      <a id="homeBtn" class="tab-item active" href="#">
        <span class="icon icon-home"></span>
        <span class="tab-label">Home</span>
      </a>
      <a id="profileBtn" class="tab-item" href="#">
        <span class="icon icon-person"></span>
        <span class="tab-label">Profile</span>
      </a>
      <a id="favoriteBtn" class="tab-item" href="#">
        <span class="icon icon-star-filled"></span>
        <span class="tab-label">Favorites</span>
      </a>
      <a id="searchBtn" class="tab-item" href="#">
        <span class="icon icon-search"></span>
        <span class="tab-label">Search</span>
      </a>
      <a id="settingBtn" class="tab-item" href="#">
        <span class="icon icon-gear"></span>
        <span class="tab-label">Settings</span>
      </a>
    </nav>
    
    <div class="content">
      <div id="login-content">
          <!-- <img src="entertainme.png" style="width:100%; height:150px;"> -->
          <div class="content-padded">
            <form>
              <div class="input-group">
                <div class="input-row">
                  <label>Email</label>
                  <input type="email" placeholder="w.m@gmail.com">
                </div>
                <div class="input-row">
                  <label>Password</label>
                  <input type="password" placeholder="goRatchet">
                </div>
              </div>

            </form>
            <br>
            
            <button id="loginBtn" class="btn btn-positive btn-block btn-outlined">Login</button>
            <button class="btn btn-negative btn-block btn-outlined">Register</button>
            <button id="loginFBBtn" class="btn btn-primary btn-block btn-outlined">Login via Facebook</button>
          </div>
      </div>
      <div id="home-content" style="display:none;">
          <div id='map_canvas' style='width:100%;height:150px;'></div>
          <ul id="venues-list" class="table-view">
          </ul>
      </div>
      <div id="profile-content" style="display:none;">
          profile
      </div>
      <div id="favorite-content" style="display:none;">
          favorite
      </div>
      <div id="search-content" style="display:none;">
        <input type="text" placeholder="Search">
      </div>
      <div id="setting-content" style="display:none;">
          <form class="input-group">
            <input type="text" placeholder="Full name">
            <input type="email" placeholder="Email">
            <input type="text" placeholder="Username">
          </form>

          <h5 class="content-padded">App settings</h5>

          <ul class="table-view">
            <li class="table-view-cell media">
              <span class="media-object pull-left icon icon-sound"></span>
              <div class="media-body">
                Enable sounds
              </div>
              <div class="toggle">
                <div class="toggle-handle"></div>
              </div>
            </li>
            <li class="table-view-cell media">
              <span class="media-object pull-left icon icon-person"></span>
              <div class="media-body">
                Parental controls
              </div>
              <div class="toggle">
                <div class="toggle-handle"></div>
              </div>
            </li>
          </ul>
          <div class="content-padded">
            <button class="btn btn-positive btn-block">Save settings</button>
          </div>
      </div>
      <div id="detail-content" style="display:none;">
          <div class="slider" id="mySlider">
            <div class="slide-group">
              <div class="slide">
                <img src="entertainme.png">
                <span class="slide-text">
                  <span class="icon icon-left-nav"></span>
                  Slide me
                </span>
              </div>
              <div class="slide">
                <img src="/assets/img/slide-2.jpg">
              </div>
              <div class="slide">
                <img src="/assets/img/slide-3.jpg">
              </div>
            </div>
          </div>
          <p id="name1"></p>
      </div>
      
    </div>
  </body>
</html>
